{% extends  'main/index.html' %}

<main>
{% block body %}
<nav class="nav container-fluid justify-content-end border-bottom shadow py-2 mb-2 px-lg-5">
  {% include 'main/second_header.html' %}
</nav>
  {% if permissions.list %}
  <div class="row m-0 p-0">

    <div class="container-fluid text-start px-lg-5">
      {{ init.0.channels }}
      {% for material in material_list %}
        {% if material.type == 'film' %}
          <div class="card shadow my-2 p-0" style="border-color: {{ material.color }};">
            <div class="card-header p-2">
              <a href="{% url 'home' %}{{ material.Progs_program_id }}" class="link-body-emphasis link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover">
                <h6 class="my-0 mx-1">{{ material.Progs_name }}{% if material.Progs_production_year %} ({{ material.Progs_production_year }}){% endif %}</h6>
              </a>
            </div>
            <div class="card-body p-2">
              <div class="row">
                <div class="col">
                  <p class="card-text m-0"><small class="text-body-secondary">
                    Канал: <a href="#" class="link-body-emphasis link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover">
                    {% if material.Task_sched_id %}{{ material.Task_sched_id|schedule_name }}{% elif not material.Task_sched_id %}{{ material.Sched_schedule_id|schedule_name }}{% endif %}</a></small>
                  </p>
                </div>
                <div class="col">
                  <p class="card-text m-0"><small class="text-body-secondary">Возрастная категория:</small>
                    <small class="text-body-primary">{% if material.Adult_Name %} {{ material.Adult_Name }}{% endif %}</small>
                  </p>
                </div>
                <div class="col">
                  <p class="card-text m-0"><small class="text-body-secondary">Крайний срок:</small>
                    <small class="text-body-primary"> {{ material.Task_deadline|date:"d E Y" }}</small>
                  </p>
                </div>
                <div class="col">
                  <p class="card-text m-0"><small class="text-body-secondary">
                  Выполняет: <a href="{% url 'home' %}worker/{{ material.Task_engineer_id }}" class="link-body-emphasis link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover">
                  {{ material.Task_engineer_id|engineer_name }}</a></small>
                  </p>
                </div>
              </div>
            </div>
          </div>
        {% elif material.type == 'season' %}
          <div class="card shadow my-2 p-0" style="border-color: {{ material.color }};">
            <div class="card-body p-2">
              <a href="{% url 'home' %}{{ material.Progs_parent_id }}" class="link-body-emphasis link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover">
                <h6 class="my-0 mx-1">{{ material.Progs_AnonsCaption|truncatechars:60 }}{% if material.Progs_production_year %} ({{ material.Progs_production_year }}){% endif %}</h6>
              </a>
            </div>
          </div>
          {% for episode in material.episode|dictsort:"Progs_episode_num" %}
            <div class="row align-items-center">
              <div class="col ps-4" style="max-width:50px">
                <svg viewBox="0 0 24 54" class="DocSearch-Hit-Tree"><g stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"><path d="M8 6v21M20 27H8.3"></path></g></svg>
              </div>
              <div class="col">
                <div class="card shadow my-2 p-0" style="border-color: {{ material.color }};">
                  <div class="card-header p-2">
                    <a href="{% url 'home' %}{{ episode.Progs_program_id }}" class="link-body-emphasis link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover">
                    <h6 class="my-0 mx-1">{{ episode.Progs_name }}</h6>
                    </a>
                  </div>
                  <div class="card-body p-2">
                    <div class="row">
                      <div class="col">
                        <p class="card-text m-0"><small class="text-body-secondary">
                        Канал: <a href="#" class="link-body-emphasis link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover">
                        {% if material.Task_sched_id %}{{ material.Task_sched_id|schedule_name }}{% elif not material.Task_sched_id %}{{ material.Sched_schedule_id|schedule_name }}{% endif %}</a></small>
                        </p>
                      </div>
                      <div class="col">
                        <p class="card-text m-0"><small class="text-body-secondary">Возрастная категория:</small>
                          <small class="text-body-primary">{% if episode.Adult_Name %} {{ episode.Adult_Name }}{% endif %}</small>
                        </p>
                      </div>
                      <div class="col">
                        <p class="card-text m-0"><small class="text-body-secondary">Крайний срок:</small>
                          <small class="text-body-primary"> {{ episode.Task_deadline|date:"d E Y" }}</small>
                        </p>
                      </div>

                      <div class="col">
                        <p class="card-text m-0"><small class="text-body-secondary">
                        Выполняет: <a href="{% url 'home' %}worker/{{ episode.Task_engineer_id }}" class="link-body-emphasis link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover">
                        {{ episode.Task_engineer_id|engineer_name }}</a></small>
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        {% endif %}
      {% endfor %}
    </div>
  </div>
  {% else %}
  <h4 class="text-center">forbidden</h4>
  {% endif %}
{% endblock %}
</main>